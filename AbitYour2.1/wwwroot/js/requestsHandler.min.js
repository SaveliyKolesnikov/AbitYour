var requestsTag = document.getElementById("successful-requests"), connection = (new signalR.HubConnectionBuilder).withUrl("/Home/Index").build(), numOfRequests = 0, durationBeforeNextRequest = 5E3, lastUpdate = Date.now() - durationBeforeNextRequest; function addNumOfRequests() { var a = Date.now(); a - lastUpdate < durationBeforeNextRequest || (lastUpdate = a, connection.invoke("addRequest")) } function updateRequestsNumber() { requestsTag.innerHTML = numOfRequests } connection.on("newRequest", function (a) { numOfRequests = parseInt(a); updateRequestsNumber() });
connection.start().then(function () { console.log("connection started"); connection.invoke("getNumberOfRequests").then(function (a) { numOfRequests = a; updateRequestsNumber() }) })["catch"](function (a) { console.error(a.message) });